<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý AI Studio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .header-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            opacity: 0.8;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 5px 10px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
        }

        .info-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .app-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-height: 600px;
        }

        .sidebar {
            background: #2c3e50;
            color: white;
            padding: 25px;
            height: 100%;
            overflow-y: auto;
        }

        .sidebar-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-list {
            list-style: none;
        }

        .category-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .category-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .category-item.active {
            background: #3498db;
        }

        .category-name {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-count {
            font-size: 0.8rem;
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 10px;
        }

        .category-delete {
            background: rgba(231, 76, 60, 0.8);
            color: white;
            border: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s ease;
            font-size: 0.7rem;
        }

        .category-item:hover .category-delete {
            opacity: 1;
        }

        .main-content {
            padding: 30px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .content-title {
            font-size: 1.8rem;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .items-count {
            background: #3498db;
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .search-container {
            margin-bottom: 25px;
        }

        .search-box {
            position: relative;
            width: 100%;
        }

        .search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .item-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 4px solid #3498db;
            position: relative;
            display: flex;
            flex-direction: column;
            height: auto;
        }

        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .item-name {
            font-size: 1.3rem;
            color: #2c3e50;
            font-weight: 600;
            line-height: 1.3;
            flex-grow: 1;
        }

        .item-actions {
            display: flex;
            gap: 8px;
        }

        .item-action {
            background: none;
            border: none;
            font-size: 1rem;
            color: #7f8c8d;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .item-action:hover {
            background: #ecf0f1;
            color: #3498db;
        }

        .item-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        .item-category {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 500;
        }

        .item-date {
            font-style: italic;
        }

        .item-description {
            color: #5a6c7d;
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }

        .item-link {
            display: inline-block;
            background: #27ae60;
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            text-align: center;
            width: 100%;
            box-sizing: border-box;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }

        .item-link:hover {
            background: #219a52;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(39, 174, 96, 0.3);
        }

        .delete-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #e74c3c;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 2;
        }

        .item-card:hover .delete-btn {
            opacity: 1;
        }

        .delete-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        .empty-state {
            text-align: center;
            padding: 60px 40px;
            color: #7f8c8d;
            grid-column: 1 / -1;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .fab-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100;
        }

        .fab-main {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #e74c3c;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .fab-main:hover {
            transform: scale(1.1);
            background: #c0392b;
        }

        .fab-options {
            position: absolute;
            bottom: 70px;
            right: 0;
            display: none;
            flex-direction: column;
            gap: 10px;
        }

        .fab-option {
            background: #3498db;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }

        .fab-option:hover {
            background: #2980b9;
            transform: translateX(-5px);
        }

        .fab-options.show {
            display: flex;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            color: #2c3e50;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #7f8c8d;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #3498db;
            outline: none;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .import-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .import-option {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .import-divider {
            text-align: center;
            margin: 10px 0;
            position: relative;
        }

        .import-divider::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e0e0e0;
        }

        .import-divider span {
            background: white;
            padding: 0 15px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: 2;
            }
            
            .main-content {
                order: 1;
            }
            
            .items-grid {
                grid-template-columns: 1fr;
            }
            
            .fab-options {
                right: auto;
                left: 0;
            }
            
            .content-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .item-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-robot"></i> Quản lý AI Studio</h1>
            <p>Tổ chức và quản lý các công cụ AI</p>
            <div class="header-info">
                <div class="info-item" onclick="showStorageInfo()">
                    <i class="fas fa-database"></i>
                    <span>Dữ liệu được lưu trữ cục bộ</span>
                </div>
                <div class="info-item" onclick="exportData()">
                    <i class="fas fa-file-export"></i>
                    <span>Xuất dữ liệu</span>
                </div>
                <div class="info-item" onclick="importData()">
                    <i class="fas fa-file-import"></i>
                    <span>Nhập dữ liệu</span>
                </div>
                <div class="info-item" onclick="showStorageInfo()">
                    <i class="fas fa-info-circle"></i>
                    <span>Thông tin lưu trữ</span>
                </div>
            </div>
        </div>

        <div class="app-container">
            <div class="sidebar">
                <div class="sidebar-title">
                    <i class="fas fa-list"></i>
                    <span>Danh mục</span>
                </div>
                <ul class="category-list" id="categoryList">
                    <!-- Categories will be populated by JavaScript -->
                </ul>
            </div>

            <div class="main-content">
                <div class="content-header">
                    <h2 class="content-title" id="currentCategory">
                        <i class="fas fa-folder"></i> 
                        <span id="categoryName">Tất cả công cụ</span>
                        <span class="items-count" id="itemsCount">0</span>
                    </h2>
                </div>

                <div class="search-container">
                    <div class="search-box">
                        <input type="text" class="search-input" id="searchInput" placeholder="Tìm kiếm công cụ...">
                        <div class="search-icon">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>
                </div>

                <div class="items-grid" id="itemsGrid">
                    <!-- AI Tool cards will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <div class="fab-container">
        <div class="fab-options" id="fabOptions">
            <div class="fab-option" onclick="showAddCategoryModal()">
                <i class="fas fa-folder-plus"></i>
                <span>Thêm danh mục</span>
            </div>
            <div class="fab-option" onclick="showAddToolModal()">
                <i class="fas fa-plus"></i>
                <span>Thêm công cụ AI</span>
            </div>
        </div>
        <div class="fab-main" id="fabMain">
            <i class="fas fa-plus"></i>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div class="modal" id="addCategoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Thêm danh mục</h3>
                <button class="close-btn" onclick="hideAddCategoryModal()">&times;</button>
            </div>
            <div class="form-group">
                <label for="categoryNameInput">Tên danh mục</label>
                <input type="text" id="categoryNameInput" placeholder="Nhập tên danh mục...">
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="hideAddCategoryModal()">Hủy</button>
                <button class="btn btn-primary" onclick="addNewCategory()">Thêm danh mục</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit AI Tool Modal -->
    <div class="modal" id="addToolModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="toolModalTitle">Thêm công cụ AI mới</h3>
                <button class="close-btn" onclick="hideAddToolModal()">&times;</button>
            </div>
            <div class="form-group">
                <label for="toolNameInput">Tên công cụ *</label>
                <input type="text" id="toolNameInput" placeholder="Nhập tên công cụ...">
            </div>
            <div class="form-group">
                <label for="toolCategorySelect">Danh mục *</label>
                <select id="toolCategorySelect">
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            <div class="form-group">
                <label for="toolDescriptionInput">Mô tả</label>
                <textarea id="toolDescriptionInput" placeholder="Mô tả ngắn về công cụ AI..."></textarea>
            </div>
            <div class="form-group">
                <label for="toolLinkInput">Đường link công cụ *</label>
                <input type="url" id="toolLinkInput" placeholder="https://...">
                <div class="help-text">Dán đường link đến công cụ AI hoặc trang web</div>
            </div>

            <div class="form-actions">
                <button class="btn btn-secondary" onclick="hideAddToolModal()">Hủy</button>
                <button class="btn btn-primary" id="saveToolBtn" onclick="saveTool()">Thêm công cụ</button>
            </div>
        </div>
    </div>

    <!-- Storage Info Modal -->
    <div class="modal" id="storageInfoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Thông tin lưu trữ</h3>
                <button class="close-btn" onclick="hideStorageInfoModal()">&times;</button>
            </div>
            <div class="form-group">
                <h4>Dữ liệu đang được lưu trữ cục bộ</h4>
                <p id="storageInfoText">Đang tải thông tin...</p>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="hideStorageInfoModal()">Đóng</button>
                <button class="btn btn-primary" onclick="clearAllData()">Xóa tất cả dữ liệu</button>
            </div>
        </div>
    </div>

    <!-- Import Data Modal -->
    <div class="modal" id="importDataModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Nhập dữ liệu</h3>
                <button class="close-btn" onclick="hideImportDataModal()">&times;</button>
            </div>
            
            <div class="import-options">
                <div class="import-option">
                    <label>Tải lên file JSON</label>
                    <input type="file" id="jsonFileInput" accept=".json" style="display: none;">
                    <button class="btn btn-primary" onclick="document.getElementById('jsonFileInput').click()" style="width: 100%;">
                        <i class="fas fa-file-upload"></i> Chọn file JSON
                    </button>
                    <div class="help-text">Chọn file JSON đã xuất trước đó để khôi phục dữ liệu</div>
                </div>
                
                <div class="import-divider">
                    <span>HOẶC</span>
                </div>
                
                <div class="import-option">
                    <label for="importDataInput">Dán dữ liệu JSON</label>
                    <textarea id="importDataInput" placeholder='Dán dữ liệu JSON tại đây...' rows="8"></textarea>
                    <div class="help-text">Dán dữ liệu đã xuất trước đó để khôi phục</div>
                </div>
            </div>
            
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="hideImportDataModal()">Hủy</button>
                <button class="btn btn-primary" onclick="processImportData()">Nhập dữ liệu</button>
            </div>
        </div>
    </div>

    <script>
        // Storage keys
        const STORAGE_KEYS = {
            CATEGORIES: 'ai_studio_categories',
            TOOLS: 'ai_studio_tools'
        };

        // Default data
        const defaultCategories = [
            { id: 'all', name: 'Tất cả công cụ', icon: 'fas fa-th-large', count: 0 },
            { id: 'design', name: 'Thiết kế & Sáng tạo', icon: 'fas fa-palette', count: 0 },
            { id: 'simulation', name: 'Mô phỏng', icon: 'fas fa-vr-cardboard', count: 0 },
            { id: 'language', name: 'Ngôn ngữ & Dịch thuật', icon: 'fas fa-language', count: 0 },
            { id: 'data-analysis', name: 'Phân tích dữ liệu', icon: 'fas fa-chart-bar', count: 0 },
            { id: 'teaching', name: 'Công cụ giảng dạy', icon: 'fas fa-chalkboard-teacher', count: 0 }
        ];

        const defaultTools = [
            {
                id: 1,
                name: "Trình tạo bài giảng tự động",
                description: "Công cụ tạo bài giảng và slide thuyết trình tự động dựa trên chủ đề và cấp độ học sinh. Hỗ trợ đa dạng môn học và định dạng bài giảng.",
                category: "teaching",
                link: "https://example.com/lesson-generator",
                created: "2024-01-15"
            },
            {
                id: 2,
                name: "Language Translator AI",
                description: "Dịch văn bản giữa nhiều ngôn ngữ với độ chính xác cao. Công cụ này sử dụng mạng nơ-ron sâu để cung cấp bản dịch tự nhiên và chính xác.",
                category: "language",
                link: "https://example.com/language-translator",
                created: "2024-01-20"
            },
            {
                id: 3,
                name: "Data Visualization AI",
                description: "Phân tích và trực quan hóa dữ liệu với AI. Công cụ này giúp bạn khám phá các mẫu và xu hướng trong dữ liệu của mình một cách trực quan.",
                category: "data-analysis",
                link: "https://example.com/data-visualization",
                created: "2024-01-25"
            },
            {
                id: 4,
                name: "Code Assistant AI",
                description: "Hỗ trợ lập trình viên viết code nhanh hơn và hiệu quả hơn. Công cụ này có thể gợi ý code, tìm lỗi và tối ưu hóa mã nguồn.",
                category: "simulation",
                link: "https://example.com/code-assistant",
                created: "2024-02-01"
            }
        ];

        // Global variables
        let categories = [];
        let tools = [];
        let currentCategoryId = 'all';
        let currentEditToolId = null;
        let searchQuery = '';

        // DOM Elements
        const categoryList = document.getElementById('categoryList');
        const itemsGrid = document.getElementById('itemsGrid');
        const categoryName = document.getElementById('categoryName');
        const itemsCount = document.getElementById('itemsCount');
        const searchInput = document.getElementById('searchInput');
        const fabMain = document.getElementById('fabMain');
        const fabOptions = document.getElementById('fabOptions');
        const addCategoryModal = document.getElementById('addCategoryModal');
        const addToolModal = document.getElementById('addToolModal');
        const storageInfoModal = document.getElementById('storageInfoModal');
        const importDataModal = document.getElementById('importDataModal');
        const toolCategorySelect = document.getElementById('toolCategorySelect');
        const jsonFileInput = document.getElementById('jsonFileInput');

        // Storage functions
        function loadFromStorage(key) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            } catch (error) {
                console.error('Error loading from storage:', error);
                return null;
            }
        }

        function saveToStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (error) {
                console.error('Error saving to storage:', error);
                alert('Lỗi khi lưu dữ liệu. Có thể bộ nhớ đã đầy.');
                return false;
            }
        }

        function saveAllData() {
            const success1 = saveToStorage(STORAGE_KEYS.CATEGORIES, categories);
            const success2 = saveToStorage(STORAGE_KEYS.TOOLS, tools);
            return success1 && success2;
        }

        // Initialize the application
        function initApp() {
            // Load data
            categories = loadFromStorage(STORAGE_KEYS.CATEGORIES) || [...defaultCategories];
            tools = loadFromStorage(STORAGE_KEYS.TOOLS) || [...defaultTools];
            
            updateCategoryCounts();
            renderCategories();
            renderTools('all');
            setupEventListeners();
            populateCategorySelect();
        }

        // Update tool counts for each category
        function updateCategoryCounts() {
            categories.forEach(category => {
                if (category.id === 'all') {
                    category.count = tools.length;
                } else {
                    category.count = tools.filter(tool => tool.category === category.id).length;
                }
            });
        }

        // Render category list
        function renderCategories() {
            categoryList.innerHTML = '';
            
            categories.forEach(category => {
                const categoryItem = document.createElement('li');
                categoryItem.className = `category-item ${category.id === currentCategoryId ? 'active' : ''}`;
                categoryItem.dataset.category = category.id;
                categoryItem.innerHTML = `
                    <div class="category-name">
                        <i class="${category.icon}"></i>
                        <span>${category.name}</span>
                    </div>
                    <span class="category-count">${category.count}</span>
                    ${category.id !== 'all' ? `<button class="category-delete" onclick="deleteCategory('${category.id}')"><i class="fas fa-times"></i></button>` : ''}
                `;
                categoryList.appendChild(categoryItem);
            });
        }

        // Render tools grid
        function renderTools(categoryId) {
            currentCategoryId = categoryId;
            
            let filteredTools = tools;
            
            // Filter by category
            if (categoryId !== 'all') {
                filteredTools = tools.filter(tool => tool.category === categoryId);
            }
            
            // Filter by search query
            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                filteredTools = filteredTools.filter(tool => 
                    tool.name.toLowerCase().includes(query) || 
                    (tool.description && tool.description.toLowerCase().includes(query))
                );
            }
            
            // Update UI
            const currentCategory = categories.find(category => category.id === categoryId);
            categoryName.textContent = currentCategory.name;
            itemsCount.textContent = filteredTools.length;
            
            // Render tool cards
            itemsGrid.innerHTML = '';
            
            if (filteredTools.length === 0) {
                itemsGrid.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-robot"></i>
                        <h3>Không có công cụ nào</h3>
                        <p>${searchQuery ? 'Không tìm thấy công cụ phù hợp với từ khóa tìm kiếm' : 'Hãy thêm công cụ AI đầu tiên cho danh mục này'}</p>
                    </div>
                `;
                return;
            }
            
            filteredTools.forEach(tool => {
                const category = categories.find(c => c.id === tool.category);
                
                const toolCard = document.createElement('div');
                toolCard.className = 'item-card';
                
                toolCard.innerHTML = `
                    <button class="delete-btn" onclick="deleteTool(${tool.id})">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="item-header">
                        <h3 class="item-name">${tool.name}</h3>
                        <div class="item-actions">
                            <button class="item-action" onclick="editTool(${tool.id})" title="Chỉnh sửa">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="item-action" onclick="openToolLink(${tool.id})" title="Mở công cụ">
                                <i class="fas fa-external-link-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="item-meta">
                        <span class="item-category">${category.name}</span>
                        <span class="item-date">${tool.created}</span>
                    </div>
                    <div class="item-description">
                        ${tool.description || 'Không có mô tả'}
                    </div>
                    <button onclick="openToolLink(${tool.id})" class="item-link">
                        <i class="fas fa-external-link-alt"></i> Truy cập phần mềm
                    </button>
                `;
                itemsGrid.appendChild(toolCard);
            });
        }

        // Search functionality
        function handleSearch() {
            searchQuery = searchInput.value.trim();
            renderTools(currentCategoryId);
        }

        // Open tool link
        function openToolLink(toolId) {
            const tool = tools.find(t => t.id === toolId);
            if (!tool) return;

            window.open(tool.link, '_blank');
        }

        // Edit tool
        function editTool(toolId) {
            const tool = tools.find(t => t.id === toolId);
            if (!tool) return;

            currentEditToolId = toolId;
            
            // Fill form with tool data
            document.getElementById('toolModalTitle').textContent = 'Chỉnh sửa công cụ AI';
            document.getElementById('toolNameInput').value = tool.name;
            document.getElementById('toolCategorySelect').value = tool.category;
            document.getElementById('toolDescriptionInput').value = tool.description || '';
            document.getElementById('toolLinkInput').value = tool.link;
            document.getElementById('saveToolBtn').textContent = 'Cập nhật công cụ';
            
            addToolModal.classList.add('show');
        }

        // Delete tool
        function deleteTool(toolId) {
            if (confirm('Bạn có chắc chắn muốn xóa công cụ AI này?')) {
                tools = tools.filter(tool => tool.id !== toolId);
                updateCategoryCounts();
                renderCategories();
                saveAllData();
                renderTools(currentCategoryId);
                alert('Đã xóa công cụ AI thành công!');
            }
        }

        // Delete category
        function deleteCategory(categoryId) {
            if (categoryId === 'all') return;
            
            // Get all tools in this category
            const categoryTools = tools.filter(tool => tool.category === categoryId);
            
            if (categoryTools.length > 0) {
                if (!confirm(`Danh mục này có ${categoryTools.length} công cụ. Tất cả sẽ bị xóa. Bạn có chắc chắn?`)) {
                    return;
                }
                // Remove tools
                tools = tools.filter(tool => tool.category !== categoryId);
            }
            
            // Remove category
            categories = categories.filter(category => category.id !== categoryId);
            
            updateCategoryCounts();
            renderCategories();
            populateCategorySelect();
            saveAllData();
            
            renderTools('all');
            alert('Đã xóa danh mục thành công!');
        }

        // Populate category select
        function populateCategorySelect() {
            toolCategorySelect.innerHTML = '';
            categories.forEach(category => {
                if (category.id !== 'all') {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    toolCategorySelect.appendChild(option);
                }
            });
        }

        // FAB functionality
        function toggleFabOptions() {
            fabOptions.classList.toggle('show');
        }

        // Category modal functions
        function showAddCategoryModal() {
            addCategoryModal.classList.add('show');
            fabOptions.classList.remove('show');
        }

        function hideAddCategoryModal() {
            addCategoryModal.classList.remove('show');
            document.getElementById('categoryNameInput').value = '';
        }

        function addNewCategory() {
            const categoryNameInput = document.getElementById('categoryNameInput');
            const categoryName = categoryNameInput.value.trim();
            
            if (!categoryName) {
                alert('Vui lòng nhập tên danh mục');
                categoryNameInput.focus();
                return;
            }

            if (categories.some(category => category.name.toLowerCase() === categoryName.toLowerCase())) {
                alert('Tên danh mục đã tồn tại');
                categoryNameInput.focus();
                return;
            }

            const newCategory = {
                id: 'category-' + Date.now(),
                name: categoryName,
                icon: 'fas fa-folder',
                count: 0
            };

            categories.push(newCategory);
            
            if (saveAllData()) {
                renderCategories();
                populateCategorySelect();
                hideAddCategoryModal();
                alert('Thêm danh mục thành công!');
            }
        }

        // Tool modal functions
        function showAddToolModal() {
            currentEditToolId = null;
            document.getElementById('toolModalTitle').textContent = 'Thêm công cụ AI mới';
            document.getElementById('saveToolBtn').textContent = 'Thêm công cụ';
            
            // Reset form
            resetToolForm();
            
            addToolModal.classList.add('show');
            fabOptions.classList.remove('show');
        }

        function hideAddToolModal() {
            addToolModal.classList.remove('show');
            currentEditToolId = null;
            resetToolForm();
        }

        function resetToolForm() {
            document.getElementById('toolNameInput').value = '';
            document.getElementById('toolCategorySelect').selectedIndex = 0;
            document.getElementById('toolDescriptionInput').value = '';
            document.getElementById('toolLinkInput').value = '';
        }

        function saveTool() {
            const name = document.getElementById('toolNameInput').value.trim();
            const category = document.getElementById('toolCategorySelect').value;
            const description = document.getElementById('toolDescriptionInput').value.trim();
            const link = document.getElementById('toolLinkInput').value.trim();

            // Validation
            if (!name) {
                alert('Vui lòng nhập tên công cụ');
                document.getElementById('toolNameInput').focus();
                return;
            }

            if (!category) {
                alert('Vui lòng chọn danh mục');
                document.getElementById('toolCategorySelect').focus();
                return;
            }

            if (!link) {
                alert('Vui lòng nhập đường link công cụ');
                document.getElementById('toolLinkInput').focus();
                return;
            }

            if (!link.startsWith('http://') && !link.startsWith('https://')) {
                alert('Vui lòng nhập đường link hợp lệ (bắt đầu với http:// hoặc https://)');
                document.getElementById('toolLinkInput').focus();
                return;
            }

            if (currentEditToolId) {
                // Update existing tool
                const toolIndex = tools.findIndex(t => t.id === currentEditToolId);
                if (toolIndex !== -1) {
                    tools[toolIndex] = {
                        ...tools[toolIndex],
                        name: name,
                        description: description,
                        category: category,
                        link: link,
                        updated: new Date().toISOString().split('T')[0]
                    };
                    
                    if (saveAllData()) {
                        updateCategoryCounts();
                        renderCategories();
                        renderTools(currentCategoryId);
                        hideAddToolModal();
                        alert('Cập nhật công cụ thành công!');
                    }
                }
            } else {
                // Add new tool
                const newTool = {
                    id: Date.now(),
                    name: name,
                    description: description,
                    category: category,
                    link: link,
                    created: new Date().toISOString().split('T')[0],
                    updated: new Date().toISOString().split('T')[0]
                };

                tools.push(newTool);
                
                if (saveAllData()) {
                    updateCategoryCounts();
                    renderCategories();
                    
                    // Switch to the category of the new tool
                    const categoryItem = document.querySelector(`.category-item[data-category="${category}"]`);
                    if (categoryItem) {
                        categoryItem.click();
                    } else {
                        renderTools(currentCategoryId);
                    }
                    
                    hideAddToolModal();
                    alert('Thêm công cụ AI thành công!');
                }
            }
        }

        // Data management functions
        function showStorageInfo() {
            const categoriesSize = JSON.stringify(categories).length;
            const toolsSize = JSON.stringify(tools).length;
            const totalSize = categoriesSize + toolsSize;
            
            const storageInfoText = document.getElementById('storageInfoText');
            storageInfoText.innerHTML = `
                <p><strong>Số lượng danh mục:</strong> ${categories.length}</p>
                <p><strong>Số lượng công cụ:</strong> ${tools.length}</p>
                <p><strong>Kích thước dữ liệu:</strong> ${(totalSize / 1024).toFixed(2)} KB</p>
                <p><strong>Dung lượng còn lại:</strong> ${(5 * 1024 * 1024 - totalSize) / (1024 * 1024)} MB (ước tính)</p>
                <p><em>Dữ liệu được lưu trữ cục bộ trong trình duyệt của bạn.</em></p>
            `;
            
            storageInfoModal.classList.add('show');
        }

        function hideStorageInfoModal() {
            storageInfoModal.classList.remove('show');
        }

        function exportData() {
            const data = {
                categories: categories,
                tools: tools,
                exportedAt: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `ai-studio-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert('Dữ liệu đã được xuất thành công!');
        }

        function importData() {
            importDataModal.classList.add('show');
        }

        function hideImportDataModal() {
            importDataModal.classList.remove('show');
            document.getElementById('importDataInput').value = '';
            jsonFileInput.value = '';
        }

        function processImportData() {
            const importDataInput = document.getElementById('importDataInput');
            const dataStr = importDataInput.value.trim();
            
            // Check if file input has a file
            if (jsonFileInput.files.length > 0) {
                const file = jsonFileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        importDataFromObject(data);
                    } catch (error) {
                        alert('File JSON không hợp lệ: ' + error.message);
                    }
                };
                
                reader.readAsText(file);
            } else if (dataStr) {
                // Process text input
                try {
                    const data = JSON.parse(dataStr);
                    importDataFromObject(data);
                } catch (error) {
                    alert('Dữ liệu JSON không hợp lệ: ' + error.message);
                }
            } else {
                alert('Vui lòng chọn file JSON hoặc nhập dữ liệu JSON');
                return;
            }
        }

        function importDataFromObject(data) {
            if (!data.categories || !data.tools) {
                alert('Dữ liệu không hợp lệ. Thiếu thông tin danh mục hoặc công cụ.');
                return;
            }
            
            if (confirm('Nhập dữ liệu mới sẽ ghi đè lên dữ liệu hiện tại. Bạn có chắc chắn?')) {
                categories = data.categories;
                tools = data.tools;
                
                if (saveAllData()) {
                    updateCategoryCounts();
                    renderCategories();
                    populateCategorySelect();
                    renderTools('all');
                    hideImportDataModal();
                    alert('Nhập dữ liệu thành công!');
                }
            }
        }

        function clearAllData() {
            if (confirm('Bạn có chắc chắn muốn xóa tất cả dữ liệu? Hành động này không thể hoàn tác.')) {
                localStorage.removeItem(STORAGE_KEYS.CATEGORIES);
                localStorage.removeItem(STORAGE_KEYS.TOOLS);
                
                categories = [...defaultCategories];
                tools = [...defaultTools];
                
                updateCategoryCounts();
                renderCategories();
                populateCategorySelect();
                renderTools('all');
                hideStorageInfoModal();
                alert('Đã xóa tất cả dữ liệu!');
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Category click event
            categoryList.addEventListener('click', (e) => {
                const categoryItem = e.target.closest('.category-item');
                if (categoryItem) {
                    document.querySelectorAll('.category-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    categoryItem.classList.add('active');
                    
                    const categoryId = categoryItem.dataset.category;
                    renderTools(categoryId);
                }
            });

            // Search input event
            searchInput.addEventListener('input', handleSearch);

            // FAB click event
            fabMain.addEventListener('click', toggleFabOptions);

            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === addCategoryModal) hideAddCategoryModal();
                if (e.target === addToolModal) hideAddToolModal();
                if (e.target === storageInfoModal) hideStorageInfoModal();
                if (e.target === importDataModal) hideImportDataModal();
            });

            // Close FAB options when clicking outside
            document.addEventListener('click', (e) => {
                if (!fabMain.contains(e.target) && !fabOptions.contains(e.target)) {
                    fabOptions.classList.remove('show');
                }
            });
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>